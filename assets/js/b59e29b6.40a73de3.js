"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[334],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>m});var a=r(7294);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,a,t=function(e,n){if(null==e)return{};var r,a,t={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var d=a.createContext({}),s=function(e){var n=a.useContext(d),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},p=function(e){var n=s(e.components);return a.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,o=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(r),m=t,f=u["".concat(d,".").concat(m)]||u[m]||c[m]||o;return r?a.createElement(f,i(i({ref:n},p),{},{components:r})):a.createElement(f,i({ref:n},p))}));function m(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=r.length,i=new Array(o);i[0]=u;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:t,i[1]=l;for(var s=2;s<o;s++)i[s]=r[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},7790:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var a=r(7462),t=r(3366),o=(r(7294),r(3905)),i=["components"],l={id:"android",title:"Android 4.4+"},d=void 0,s={unversionedId:"installation/android",id:"installation/android",title:"Android 4.4+",description:"Starting with React Native 0.60 due to a new auto linking feature you no longer need to follow manual linking steps but you will need to follow the other steps below if you plan on releasing your app to production.",source:"@site/docs/installation/android.md",sourceDirName:"installation",slug:"/installation/android",permalink:"/handbook/docs/installation/android",draft:!1,editUrl:"https://github.com/react-native-webrtc/handbook/edit/master/docs/installation/android.md",tags:[],version:"current",frontMatter:{id:"android",title:"Android 4.4+"},sidebar:"docs",previous:{title:"Installation",permalink:"/handbook/docs/category/installation"},next:{title:"iOS 11+",permalink:"/handbook/docs/installation/ios"}},p={},c=[{value:"Declaring Permissions",id:"declaring-permissions",level:2},{value:"Enable Java 8 Support",id:"enable-java-8-support",level:2},{value:"R8/ProGuard Support",id:"r8proguard-support",level:2},{value:"Screen Capture Support - Android 10+",id:"screen-capture-support---android-10",level:2},{value:"Fatal Exception: java.lang.UnsatisfiedLinkError",id:"fatal-exception-javalangunsatisfiedlinkerror",level:2}],u={toc:c};function m(e){var n=e.components,r=(0,t.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Starting with React Native 0.60 due to a new auto linking feature you no longer need to follow manual linking steps but you will need to follow the other steps below if you plan on releasing your app to production.  "),(0,o.kt)("p",null,"See a sample app in the ",(0,o.kt)("inlineCode",{parentName:"p"},"examples/GumTestApp")," directory.  "),(0,o.kt)("h2",{id:"declaring-permissions"},"Declaring Permissions"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"android/app/main/AndroidManifest.xml")," add the following permissions before the ",(0,o.kt)("inlineCode",{parentName:"p"},"<application>")," section.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<uses-feature android:name="android.hardware.camera" />\n<uses-feature android:name="android.hardware.camera.autofocus" />\n<uses-feature android:name="android.hardware.audio.output" />\n<uses-feature android:name="android.hardware.microphone" />\n\n<uses-permission android:name="android.permission.CAMERA" />\n<uses-permission android:name="android.permission.RECORD_AUDIO" />\n<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />\n<uses-permission android:name="android.permission.CHANGE_NETWORK_STATE" />\n<uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />\n<uses-permission android:name="android.permission.INTERNET" />\n')),(0,o.kt)("p",null,"If you plan to also support Bluetooth devices then also add the following."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<uses-permission android:name="android.permission.BLUETOOTH" android:maxSdkVersion="30" />\n<uses-permission android:name="android.permission.BLUETOOTH_ADMIN" android:maxSdkVersion="30" />\n<uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />\n')),(0,o.kt)("h2",{id:"enable-java-8-support"},"Enable Java 8 Support"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle")," add the following inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"android")," section."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-gradle"},"compileOptions {\n    sourceCompatibility JavaVersion.VERSION_1_8\n    targetCompatibility JavaVersion.VERSION_1_8\n}\n")),(0,o.kt)("h2",{id:"r8proguard-support"},"R8/ProGuard Support"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"android/app/proguard-rules.pro")," add the following on a new line."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-proguard"},"-keep class com.oney.WebRTCModule.** { *; }\n-keep class org.webrtc.** { *; }\n")),(0,o.kt)("h2",{id:"screen-capture-support---android-10"},"Screen Capture Support - Android 10+"),(0,o.kt)("p",null,"You'll need ",(0,o.kt)("a",{parentName:"p",href:"https://notifee.app/react-native/docs/overview"},"Notifee")," or another library that can handle foreground services for you.",(0,o.kt)("br",{parentName:"p"}),"\n","The basic requirement to get screen capturing working since Android 10 and above is to have a foreground service with ",(0,o.kt)("inlineCode",{parentName:"p"},"mediaProjection")," included as a service type and to have that service running before starting a screen capture session.  "),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"android/app/main/AndroidManifest.xml")," add the following inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"<application>")," section.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<service\n    android:name="app.notifee.core.ForegroundService"\n    android:foregroundServiceType="mediaProjection|camera|microphone" />\n')),(0,o.kt)("p",null,"The following will create an ongoing persistent notification which also comes with a foreground service.",(0,o.kt)("br",{parentName:"p"}),"\n","You will be prompted for permissions automatically each time you want to initialise screen capturing.",(0,o.kt)("br",{parentName:"p"}),"\n","A notification channel is also required and created.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import notifee, { AndroidImportance } from '@notifee/react-native';\n\ntry {\n    const channelId = await notifee.createChannel( {\n        id: 'screen_capture',\n        name: 'Screen Capture',\n        lights: false,\n        vibration: false,\n        importance: AndroidImportance.DEFAULT\n    } );\n\n    await notifee.displayNotification( {\n        title: 'Screen Capture',\n        body: 'This notification will be here until you stop capturing.',\n        android: {\n            channelId,\n            asForegroundService: true\n        }\n    } );\n} catch( err ) {\n    // Handle Error\n};\n")),(0,o.kt)("p",null,"Once screen capturing has finished you should then stop the foreground service.",(0,o.kt)("br",{parentName:"p"}),"\n","Usually you'd run a notification cancellation function but as the service is involved, instead run the following.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"try {\n    await notifee.stopForegroundService();\n} catch( err ) {\n    // Handle Error\n};\n")),(0,o.kt)("p",null,"Lastly you'll need to add this to your projects main ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js")," file.",(0,o.kt)("br",{parentName:"p"}),"\n","Otherwise you'll receive errors relating to the foreground service not being registered correctly.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"notifee.registerForegroundService( notification => {\n    return new Promise( () => {\n\n    } );\n} );\n")),(0,o.kt)("h2",{id:"fatal-exception-javalangunsatisfiedlinkerror"},"Fatal Exception: java.lang.UnsatisfiedLinkError"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Fatal Exception: java.lang.UnsatisfiedLinkError: No implementation found for void org.webrtc.PeerConnectionFactory.nativeInitializeAndroidGlobals() (tried Java_org_webrtc_PeerConnectionFactory_nativeInitializeAndroidGlobals and Java_org_webrtc_PeerConnectionFactory_nativeInitializeAndroidGlobals__)\n    at org.webrtc.PeerConnectionFactory.nativeInitializeAndroidGlobals(PeerConnectionFactory.java)\n    at org.webrtc.PeerConnectionFactory.initialize(PeerConnectionFactory.java:306)\n    at com.oney.WebRTCModule.WebRTCModule.initAsync(WebRTCModule.java:79)\n    at com.oney.WebRTCModule.WebRTCModule.lambda$new$0(WebRTCModule.java:70)\n    at com.oney.WebRTCModule.-$$Lambda$WebRTCModule$CnyHZvkjDxq52UReGHUZlY0JsVw.run(-.java:4)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1162)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:636)\n    at java.lang.Thread.run(Thread.java:764)\n")),(0,o.kt)("p",null,"If you're experiencing the error above then in ",(0,o.kt)("inlineCode",{parentName:"p"},"android/gradle.properties")," add the following.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# This one fixes a weird WebRTC runtime problem on some devices.\n# https://github.com/jitsi/jitsi-meet/issues/7911#issuecomment-714323255\n\nandroid.enableDexingArtifactTransform.desugaring=false\n")))}m.isMDXComponent=!0}}]);